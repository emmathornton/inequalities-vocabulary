---
title: "cross cohort compairson results"
output:
  word_document: default
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: console
---

libraries and custom functions

```{r}
library(mice)
library(pander)
library(xtable)
library(dplyr)
library(gt)
library(glue)
library(tidyverse)
library(miceadds)
library(swfscMisc)
library(imputools)
library(haven)
library(sjmisc)
library(Hmisc)
library(psych)
library(lavaan)
library(ggplot2)
library(ggpubr)
library(flextable)


#this will take a float (e.g. a p value) and return a string with 3 digits and no leading 0

bv <- function(val) {
  return(sub("^(-?)0.", "\\1.", sprintf("%.2f", val)))
}

#if the number is less than .001, it will give <.001. 
pv1 <- function(val) {
  return(paste("=", sub("^(-?)0.", "\\1.", sprintf("%.3f", val))))
}



```



#load in datasets for each cohort 

```{r}
load("~/Documents/PhD/MCS DATASETS/SES_inequalities_language/inequalities-language-ability/Datasets/final datasets/2021-02-26_mcs_ses_crossCohort.Rdata")
mcs_imputation = mi.res
load("~/Documents/PhD/MCS DATASETS/SES_inequalities_language/inequalities-language-ability/Datasets/final datasets/2021-02-26_bcs_ses_cross_cohort.Rdata")
bcs_imputation = mi.res

```


regression models. want one for each age (early childhood, late childhood, adolescence) for occupational status and for education, in both cohorts. 
confounders only models for R2 table later.  

```{r}
#regression models####

#MCS2001 regressions 

#age 5
mcs_age5_occupation <- with(mcs_imputation, lm(standardised_vocab5 ~ gender + ethnicity +  EAL + standardised_age5+  occupational_status, weights = weight)) 
mcs_age5_education <- with(mcs_imputation, lm(standardised_vocab5 ~ gender + ethnicity +  EAL + standardised_age5+ highest_household_education, weights = weight))
mcs_age5_confounders<- with(mcs_imputation, lm(standardised_vocab5 ~ gender + ethnicity +  EAL + standardised_age5, weights = weight))
#age 11
mcs_age11_occupation <- with(mcs_imputation, lm(standardised_vocab11 ~ gender + ethnicity +  EAL + standardised_age11+  occupational_status, weights = weight)) 
mcs_age11_education <- with(mcs_imputation, lm(standardised_vocab11 ~ gender + ethnicity +  EAL + standardised_age11+ highest_household_education, weights = weight))
mcs_age11_confounders<- with(mcs_imputation, lm(standardised_vocab11 ~ gender + ethnicity +  EAL + standardised_age11,weights = weight))
#age 14
mcs_age14_occupation <- with(mcs_imputation, lm(standardised_vocab14 ~ gender + ethnicity +  EAL + standardised_age14+  occupational_status,weights = weight)) 
mcs_age14_education <- with(mcs_imputation, lm(standardised_vocab14 ~ gender + ethnicity +  EAL + standardised_age14+ highest_household_education,weights = weight))
mcs_age14_confounders<- with(mcs_imputation, lm(standardised_vocab14 ~ gender + ethnicity +  EAL + standardised_age14,weights = weight))

#BCS1970 regressions 
bcs_age5_occupation <- with(bcs_imputation, lm(standardised_vocab5 ~ gender + ethnicity +  EAL + standardised_age5+  occupational_status,weights = weight)) 
bcs_age5_education <- with(bcs_imputation, lm(standardised_vocab5 ~ gender + ethnicity +  EAL + standardised_age5+ highest_household_education,weights = weight))
bcs_age5_confounders<- with(bcs_imputation, lm(standardised_vocab5 ~ gender + ethnicity +  EAL + standardised_age5, weights = weight))
#age 10
bcs_age10_occupation <- with(bcs_imputation, lm(standardised_vocab10 ~ gender + ethnicity +  EAL + standardised_age10+  occupational_status, weights = weight)) 
bcs_age10_education <- with(bcs_imputation, lm(standardised_vocab10 ~ gender + ethnicity +   EAL + standardised_age10+ highest_household_education, weights = weight))
bcs_age10_confounders<- with(bcs_imputation, lm(standardised_vocab10 ~ gender + ethnicity +  EAL + standardised_age10, weights = weight))
#age 16
bcs_age16_occupation <- with(bcs_imputation, lm(standardised_vocab16 ~ gender + ethnicity +  EAL + standardised_age16+  occupational_status, weights = weight)) 
bcs_age16_education <- with(bcs_imputation, lm(standardised_vocab16 ~ gender + ethnicity +  EAL + standardised_age16+ highest_household_education, weights = weight))
bcs_age16_confounders<- with(bcs_imputation, lm(standardised_vocab16 ~ gender + ethnicity +  EAL + standardised_age16, weights = weight))

```


get the coefficients for the SES measures. 


```{r}
mcs_age5_occupation_results = round(summary(pool(mcs_age5_occupation), conf.int =TRUE),2)
mcs_age5_education_results = round(summary(pool(mcs_age5_education), conf.int =TRUE),2)
mcs_age11_occupation_results = round(summary(pool(mcs_age11_occupation), conf.int =TRUE),2)
mcs_age11_education_results = round(summary(pool(mcs_age11_education), conf.int =TRUE),2)
mcs_age14_occupation_results = round(summary(pool(mcs_age14_occupation), conf.int =TRUE),2)
mcs_age14_education_results = round(summary(pool(mcs_age14_education), conf.int =TRUE),2)


bcs_age5_occupation_results = round(summary(pool(bcs_age5_occupation), conf.int =TRUE),2)
bcs_age5_education_results = round(summary(pool(bcs_age5_education), conf.int =TRUE),2)
bcs_age10_occupation_results = round(summary(pool(bcs_age10_occupation), conf.int =TRUE),2)
bcs_age10_education_results = round(summary(pool(bcs_age10_education), conf.int =TRUE),2)
bcs_age16_occupation_results = round(summary(pool(bcs_age16_occupation), conf.int =TRUE),2)
bcs_age16_education_results = round(summary(pool(bcs_age16_education), conf.int =TRUE),2)


#pull out SES coefficients for table

MCS_age5_occupation_results = mcs_age5_occupation_results[6:8,]
MCS_age5_education_results = mcs_age5_education_results[6:8,]
MCS_age11_occupation_results = mcs_age11_occupation_results[6:8,]
MCS_age11_education_results = mcs_age11_education_results[6:8,]
MCS_age14_occupation_results = mcs_age14_occupation_results[6:8,]
MCS_age14_education_results = mcs_age14_education_results[6:8,]

BCS_age5_occupation_results = bcs_age5_occupation_results[6:8,]
BCS_age5_education_results = bcs_age5_education_results[6:8,]
BCS_age10_occupation_results = bcs_age10_occupation_results[6:8,]
BCS_age10_education_results = bcs_age10_education_results[6:8,]
BCS_age16_occupation_results = bcs_age16_occupation_results[6:8,]
BCS_age16_education_results = bcs_age16_education_results[6:8,]

MCS_age5_results = rbind(MCS_age5_occupation_results, MCS_age5_education_results)
MCS_age11_results = rbind(MCS_age11_occupation_results, MCS_age11_education_results)
MCS_age14_results = rbind(MCS_age14_occupation_results, MCS_age14_education_results)
BCS_age5_results = rbind(BCS_age5_occupation_results, BCS_age5_education_results)
BCS_age10_results = rbind(BCS_age10_occupation_results, BCS_age10_education_results)
BCS_age16_results = rbind(BCS_age16_occupation_results, BCS_age16_education_results)
```


prepare data for tables

```{r}


MCS_age5_results$estimate = bv(MCS_age5_results$estimate) #no leading 0 
#MCS_age5_results$estimate = round(MCS_age5_results$estimate,2)
MCS_age5_results$`2.5 %` = bv(MCS_age5_results$`2.5 %`)
MCS_age5_results$`97.5 %` = bv(MCS_age5_results$`97.5 %`)
MCS_age5_results$p.value1= ifelse(MCS_age5_results$p.value< .001, "<.001" , pv1(MCS_age5_results$p.value))
#MCS_age5_results$p.value = round(MCS_age5_results$p.value, 3)
MCS_age5_results$coefficient = paste0(MCS_age5_results$estimate, "[", MCS_age5_results$`2.5 %`, ";", MCS_age5_results$`97.5 %`, "]")
#MCS_age5_results$p.value [MCS_age5_results$p.value <.001] <- paste0("<.001") #change p=0.000 to p<.001
MCS_age5_results$stars = add.significance.stars(MCS_age5_results$p.value, cutoffs=c(0.05, 0.01, 0.001))
MCS_age5_results$p1 = paste0(MCS_age5_results$p.value1, "")
MCS_age5_results$p = paste0("p", MCS_age5_results$p1)
MCS_age5_results$new_coef = paste0(MCS_age5_results$coefficient, MCS_age5_results$stars)  #combine coefficients and stars into column.


MCS_age11_results$estimate = bv(MCS_age11_results$estimate) #no leading 0 
#MCS_age11_results$estimate = round(MCS_age11_results$estimate,2)
MCS_age11_results$`2.5 %` = bv(MCS_age11_results$`2.5 %`)
MCS_age11_results$`97.5 %` = bv(MCS_age11_results$`97.5 %`)
MCS_age11_results$p.value1= ifelse(MCS_age11_results$p.value< .001, "<.001" , pv1(MCS_age11_results$p.value))
#MCS_age11_results$p.value = round(MCS_age11_results$p.value, 3)
MCS_age11_results$coefficient = paste0(MCS_age11_results$estimate, "[", MCS_age11_results$`2.5 %`, ";", MCS_age11_results$`97.5 %`, "]")
#MCS_age11_results$p.value [MCS_age11_results$p.value <.001] <- paste0("<.001") #change p=0.000 to p<.001
MCS_age11_results$stars = add.significance.stars(MCS_age11_results$p.value, cutoffs=c(0.05, 0.01, 0.001))
MCS_age11_results$p1 = paste0(MCS_age11_results$p.value1, "")
MCS_age11_results$p = paste0("p", MCS_age11_results$p1)
MCS_age11_results$new_coef = paste0(MCS_age11_results$coefficient, MCS_age11_results$stars)  #combine coefficients and stars into column.


MCS_age14_results$estimate = bv(MCS_age14_results$estimate) #no leading 0 
#MCS_age14_results$estimate = round(MCS_age14_results$estimate,2)
MCS_age14_results$`2.5 %` = bv(MCS_age14_results$`2.5 %`)
MCS_age14_results$`97.5 %` = bv(MCS_age14_results$`97.5 %`)
MCS_age14_results$p.value1= ifelse(MCS_age14_results$p.value< .001, "<.001" , pv1(MCS_age14_results$p.value))
#MCS_age14_results$p.value = round(MCS_age14_results$p.value, 3)
MCS_age14_results$coefficient = paste0(MCS_age14_results$estimate, "[", MCS_age14_results$`2.5 %`, ";", MCS_age14_results$`97.5 %`, "]")
#MCS_age14_results$p.value [MCS_age14_results$p.value <.001] <- paste0("<.001") #change p=0.000 to p<.001
MCS_age14_results$stars = add.significance.stars(MCS_age14_results$p.value, cutoffs=c(0.05, 0.01, 0.001))
MCS_age14_results$p1 = paste0(MCS_age14_results$p.value1, "")
MCS_age14_results$p = paste0("p", MCS_age14_results$p1)
MCS_age14_results$new_coef = paste0(MCS_age14_results$coefficient, MCS_age14_results$stars)  #combine coefficients and stars into column.

BCS_age5_results$estimate = bv(BCS_age5_results$estimate) #no leading 0 
#BCS_age5_results$estimate = round(BCS_age5_results$estimate,2)
BCS_age5_results$`2.5 %` = bv(BCS_age5_results$`2.5 %`)
BCS_age5_results$`97.5 %` = bv(BCS_age5_results$`97.5 %`)
BCS_age5_results$p.value1= ifelse(BCS_age5_results$p.value< .001, "<.001" , pv1(BCS_age5_results$p.value))
#BCS_age5_results$p.value = round(BCS_age5_results$p.value, 3)
BCS_age5_results$coefficient = paste0(BCS_age5_results$estimate, "[", BCS_age5_results$`2.5 %`, ";", BCS_age5_results$`97.5 %`, "]")
#BCS_age5_results$p.value [BCS_age5_results$p.value <.001] <- paste0("<.001") #change p=0.000 to p<.001
BCS_age5_results$stars = add.significance.stars(BCS_age5_results$p.value, cutoffs=c(0.05, 0.01, 0.001))
BCS_age5_results$p1 = paste0(BCS_age5_results$p.value1, "")
BCS_age5_results$p = paste0("p", BCS_age5_results$p1)
BCS_age5_results$new_coef = paste0(BCS_age5_results$coefficient, BCS_age5_results$stars)  #combine coefficients and stars into column.


BCS_age10_results$estimate = bv(BCS_age10_results$estimate) #no leading 0 
#BCS_age10_results$estimate = round(BCS_age10_results$estimate,2)
BCS_age10_results$`2.5 %` = bv(BCS_age10_results$`2.5 %`)
BCS_age10_results$`97.5 %` = bv(BCS_age10_results$`97.5 %`)
BCS_age10_results$p.value1= ifelse(BCS_age10_results$p.value< .001, "<.001" , pv1(BCS_age10_results$p.value))
#BCS_age10_results$p.value = round(BCS_age10_results$p.value, 3)
BCS_age10_results$coefficient = paste0(BCS_age10_results$estimate, "[", BCS_age10_results$`2.5 %`, ";", BCS_age10_results$`97.5 %`, "]")
#BCS_age10_results$p.value [BCS_age10_results$p.value <.001] <- paste0("<.001") #change p=0.000 to p<.001
BCS_age10_results$stars = add.significance.stars(BCS_age10_results$p.value, cutoffs=c(0.05, 0.01, 0.001))
BCS_age10_results$p1 = paste0(BCS_age10_results$p.value1, "")
BCS_age10_results$p = paste0("p", BCS_age10_results$p1)
BCS_age10_results$new_coef = paste0(BCS_age10_results$coefficient, BCS_age10_results$stars)  #combine coefficients and stars into column.

BCS_age16_results$estimate = bv(BCS_age16_results$estimate) #no leading 0 
#BCS_age16_results$estimate = round(BCS_age16_results$estimate,2)
BCS_age16_results$`2.5 %` = bv(BCS_age16_results$`2.5 %`)
BCS_age16_results$`97.5 %` = bv(BCS_age16_results$`97.5 %`)
BCS_age16_results$p.value1= ifelse(BCS_age16_results$p.value< .001, "<.001" , pv1(BCS_age16_results$p.value))
#BCS_age16_results$p.value = round(BCS_age16_results$p.value, 3)
BCS_age16_results$coefficient = paste0(BCS_age16_results$estimate, "[", BCS_age16_results$`2.5 %`, ";", BCS_age16_results$`97.5 %`, "]")
#BCS_age16_results$p.value [BCS_age16_results$p.value <.001] <- paste0("<.001") #change p=0.000 to p<.001
BCS_age16_results$stars = add.significance.stars(BCS_age16_results$p.value, cutoffs=c(0.05, 0.01, 0.001))
BCS_age16_results$p1 = paste0(BCS_age16_results$p.value1, "")
BCS_age16_results$p = paste0("p", BCS_age16_results$p1)
BCS_age16_results$new_coef = paste0(BCS_age16_results$coefficient, BCS_age16_results$stars)  #combine coefficients and stars into column.

MCS_age5_tableData <- MCS_age5_results %>% 
  select(term, new_coef, p) 
  names(MCS_age5_tableData) =c("term", "MCS_coef5", "MCS_p5")

MCS_age11_tableData <- MCS_age11_results %>% 
  select(term, new_coef, p)
names(MCS_age11_tableData) =c("term", "MCS_coef11", "MCS_p11")

MCS_age14_tableData <- MCS_age14_results %>% 
  select(term, new_coef, p)
names(MCS_age14_tableData) =c("term", "MCS_coef14", "MCS_p14")

BCS_age5_tableData <- BCS_age5_results %>% 
  select(term, new_coef, p)
names(BCS_age5_tableData) =c("term", "BCS_coef5", "BCS_p5")

BCS_age10_tableData <- BCS_age10_results %>% 
  select(term, new_coef, p)
names(BCS_age10_tableData) =c("term", "BCS_coef10", "BCS_p10")

BCS_age16_tableData <- BCS_age16_results %>% 
  select(term, new_coef, p)
names(BCS_age16_tableData) =c("term", "BCS_coef16", "BCS_p16")


BCS_data <- merge(all=TRUE, BCS_age5_tableData, BCS_age10_tableData, by="term")
BCS_data <- merge(all=TRUE, BCS_data, BCS_age16_tableData, by="term")

MCS_data <- merge(all=TRUE, MCS_age5_tableData, MCS_age11_tableData, by="term")
MCS_data <- merge(all=TRUE, MCS_data,MCS_age14_tableData, by="term")


BCS_data$early_childhood_bcs = paste0(BCS_data$BCS_coef5,"\n", BCS_data$BCS_p5)
BCS_data$late_childhood_bcs = paste0(BCS_data$BCS_coef10,"\n", BCS_data$BCS_p10)
BCS_data$adolescence_bcs = paste0(BCS_data$BCS_coef16,"\n", BCS_data$BCS_p16)

MCS_data$early_childhood_mcs = paste0(MCS_data$MCS_coef5,"\n", MCS_data$MCS_p5)
MCS_data$late_childhood_mcs = paste0(MCS_data$MCS_coef11,"\n", MCS_data$MCS_p11)
MCS_data$adolescence_mcs = paste0(MCS_data$MCS_coef14,"\n", MCS_data$MCS_p14)



BCS = BCS_data %>% 
  select (term, early_childhood_bcs, late_childhood_bcs, adolescence_bcs)

MCS = MCS_data %>% 
  select (term, early_childhood_mcs, late_childhood_mcs, adolescence_mcs)




cross_cohort_data = cbind(BCS, MCS)

names(cross_cohort_data) = c("Indicator","early_childhood_bcs" ,"late_childhood_bcs","adolescent_bcs","term" ,"early_childhood_mcs",  "late_childhood_mcs", "adolescent_mcs")


cross_cohort_data <- cross_cohort_data %>% 
  select(Indicator, early_childhood_bcs,  late_childhood_bcs, adolescent_bcs, early_childhood_mcs, late_childhood_mcs, adolescent_mcs)

#add in reference categories 
cross_cohort_data = cross_cohort_data  %>% add_row(Indicator= "highest_household_education1",  .before=1) %>% 
  add_row(Indicator= "occupational_status2",  .before=5) 
cross_cohort_data[is.na(cross_cohort_data)] <- "REFERENCE"

#add indicator labels for vertical column in table. space for most of these as will merge cells later. 
cross_cohort_data = cross_cohort_data %>%  add_column(z= c("Parent Education", "  ", "  ", "  ", 
                                                     
                                                     "Occupational Status",  "  ", "  ", "  "
                                                    ),.before = 1)


#rename SES variables
cross_cohort_data$Indicator <- c("No/low level \n qualifications", "O levels/ GCSEs  \n grades A*-C", "Post 16 education", "University level \n qualifications", 
                            "Routine", "Unemployed", "Intermediate", "Higher managerial ")

cross_cohort_data[is.na(cross_cohort_data)] <- "   "
```



#create table with flextable package, which can be exported to word 

```{r}
library(officer)

#define border
my_border = border= fp_border(color="black", width=1)
cross_cohort_flex <- cross_cohort_data %>% 
  flextable() %>% 
  font(fontname = "Times New Roman", part="all") %>% 
  fontsize(size=9, part = "all") %>% 
  align(j=2, align="left", part="all") %>% 
  align(j=3:8, align="center", part="all") %>% 
  color(j=1:8, color="black", part="all") %>% 
  width(j=1, width=0.3) %>% 
  width(j=2, width=0.8) %>% 
  width(j=3:8, width=1.1) %>% 
  line_spacing(j=3:8, space=1.5) %>% 
  line_spacing(j=1, space=1.5) %>% 
  border_remove() %>% 
  hline_top(j=1:8, part="all", border=my_border) %>% 
  hline_bottom(j=1:8,part="body",  border=my_border) %>% 
  set_header_labels(z= " ", Inidcator= "Indicator",early_childhood_bcs= "Early Childhood Vocabulary (BCS)", late_childhood_bcs="Late Childhood Vocabulary (BCS)",
                    adolescent_bcs = "Adolescent Vocabulary (BCS)",
                    early_childhood_mcs ="Early Childhood Vocabulary (MCS)", late_childhood_mcs="Late Childhood Vocabulary (MCS)", 
                    adolescent_mcs = "Adolescent Vocabulary (MCS)") %>% 
  merge_at(j=1, i = 1:4) %>% 
  merge_at(j=1, i=5:8) %>% 
  rotate(i=1:4, j=1, rotation="btlr", align="center") %>% 
  rotate(i=5:8, j=1, rotation="btlr", align="center") %>% 
 print( preview = "docx") 



 
```



r squared values

```{r}
#MCS2001
mcs_age5_occupation_r2 = round(pool.r.squared(mcs_age5_occupation),4)*100
mcs_age11_occupation_r2 = round(pool.r.squared(mcs_age11_occupation),4)*100
mcs_age14_occupation_r2 = round(pool.r.squared(mcs_age14_occupation),4)*100

mcs_age5_education_r2 = round(pool.r.squared(mcs_age5_education),4)*100
mcs_age11_education_r2= round(pool.r.squared(mcs_age11_education),4)*100
mcs_age14_education_r2 = round(pool.r.squared(mcs_age14_education),4)*100

mcs_age5_confounders_r2 = round(pool.r.squared(mcs_age5_confounders), 4)*100
mcs_age11_confounders_r2= round(pool.r.squared(mcs_age11_confounders), 4)*100
mcs_age14_confounders_r2= round(pool.r.squared(mcs_age14_confounders), 4)*100

#partial r squared
mcs_age5_occupation_partial = mcs_age5_occupation_r2 - mcs_age5_confounders_r2
mcs_age5_education_partial = mcs_age5_education_r2 - mcs_age5_confounders_r2
mcs_age11_occupation_partial = mcs_age11_occupation_r2 - mcs_age11_confounders_r2
mcs_age11_education_partial = mcs_age11_education_r2 - mcs_age11_confounders_r2
mcs_age14_occupation_partial = mcs_age14_occupation_r2 - mcs_age14_confounders_r2
mcs_age14_education_partial = mcs_age14_education_r2 - mcs_age14_confounders_r2

#BCS1970
bcs_age5_occupation_r2 = round(pool.r.squared(bcs_age5_occupation),4)*100
bcs_age10_occupation_r2 = round(pool.r.squared(bcs_age10_occupation),4)*100
bcs_age16_occupation_r2 = round(pool.r.squared(bcs_age16_occupation),4)*100

bcs_age5_education_r2 = round(pool.r.squared(bcs_age5_education),4)*100
bcs_age10_education_r2= round(pool.r.squared(bcs_age10_education),4)*100
bcs_age16_education_r2 = round(pool.r.squared(bcs_age16_education),4)*100

bcs_age5_confounders_r2 = round(pool.r.squared(bcs_age5_confounders), 4)*100
bcs_age10_confounders_r2= round(pool.r.squared(bcs_age10_confounders), 4)*100
bcs_age16_confounders_r2= round(pool.r.squared(bcs_age16_confounders), 4)*100

#partial r squared
bcs_age5_occupation_partial = bcs_age5_occupation_r2 - bcs_age5_confounders_r2
bcs_age5_education_partial= bcs_age5_education_r2 - bcs_age5_confounders_r2
bcs_age10_occupation_partial = bcs_age10_occupation_r2 - bcs_age10_confounders_r2
bcs_age10_education_partial = bcs_age10_education_r2 - bcs_age10_confounders_r2
bcs_age16_occupation_partial= bcs_age16_occupation_r2 - bcs_age16_confounders_r2
bcs_age16_education_partial= bcs_age16_education_r2 - bcs_age16_confounders_r2


bcs_partial = as.data.frame(rbind(bcs_age5_education_partial,  bcs_age10_education_partial, bcs_age16_education_partial, bcs_age5_occupation_partial, bcs_age10_occupation_partial, bcs_age16_occupation_partial))
mcs_partial = as.data.frame(rbind(mcs_age5_education_partial,  mcs_age11_education_partial, mcs_age14_education_partial, mcs_age5_occupation_partial, mcs_age11_occupation_partial, mcs_age14_occupation_partial))


bcs_partial = bcs_partial %>%  add_column(indicator= c("Parent Education (early bcs)", "Parent education(late bcs)", "parent education (adolescent bcs)", "Occupation (early bcs)", "occupation (late bcs)", "occupation(adolescent bcs)"), .before = 1)
mcs_partial = mcs_partial %>%  add_column(indicator= c("Parent Education (early mcs)", "Parent education(late mcs)", "parent education (adolescent mcs)", "Occupation (early mcs)", "occupation (late mcs)", "occupation(adolescent mcs)"), .before = 1)

bcs_partial = bcs_partial[,1:2]
mcs_partial = mcs_partial[,1:2]

partial_r2_values = cbind(bcs_partial, mcs_partial)
rownames(partial_r2_values) <- NULL


```

create data for plots 

```{r}

#early childhood education data
#add ref category
MCS_age5_education_results= MCS_age5_education_results %>% add_row(term = "highest_household_education1",  .before=1)
MCS_age5_education_results[is.na(MCS_age5_education_results)] <- 0
BCS_age5_education_results= BCS_age5_education_results %>% add_row(term = "highest_household_education1",  .before=1)
BCS_age5_education_results[is.na(BCS_age5_education_results)] <- 0
#add cohort
MCS_age5_education_results = MCS_age5_education_results %>%  mutate(cohort = c("MCS2001"))
BCS_age5_education_results = BCS_age5_education_results %>%  mutate(cohort = c("BCS1970"))
#combine cohorts 
early_childhood_education_plotData = rbind(BCS_age5_education_results, MCS_age5_education_results)
#pull out coefficient, 95% CIs and cohort for plot
early_childhood_education_plotData = early_childhood_education_plotData %>% 
  select(term, estimate,  `2.5 %`, `97.5 %` , cohort)

names(early_childhood_education_plotData) <- c("parent_education", "vocabulary", "lower_ci", "upper_ci", "cohort")

#late childhood education data
#late childhood education data
#add ref category
MCS_age11_education_results= MCS_age11_education_results %>% add_row(term = "highest_household_education1",  .before=1)
MCS_age11_education_results[is.na(MCS_age11_education_results)] <- 0
BCS_age10_education_results= BCS_age10_education_results %>% add_row(term = "highest_household_education1",  .before=1)
BCS_age10_education_results[is.na(BCS_age10_education_results)] <- 0
#add cohort
MCS_age11_education_results = MCS_age11_education_results %>%  mutate(cohort = c("MCS2001"))
BCS_age10_education_results = BCS_age10_education_results %>%  mutate(cohort = c("BCS1970"))
#combine cohorts 
late_childhood_education_plotData = rbind(BCS_age10_education_results, MCS_age11_education_results)
#pull out coefficient, 95% CIs and cohort for plot
late_childhood_education_plotData  = late_childhood_education_plotData  %>% 
  select(term, estimate,  `2.5 %`, `97.5 %` , cohort)

names(late_childhood_education_plotData) <- c("parent_education", "vocabulary", "lower_ci", "upper_ci", "cohort")

#adolescent education data
MCS_age14_education_results= MCS_age14_education_results %>% add_row(term = "highest_household_education1",  .before=1)
MCS_age14_education_results[is.na(MCS_age14_education_results)] <- 0
BCS_age16_education_results= BCS_age16_education_results %>% add_row(term = "highest_household_education1",  .before=1)
BCS_age16_education_results[is.na(BCS_age16_education_results)] <- 0
#add cohort
MCS_age14_education_results = MCS_age14_education_results %>%  mutate(cohort = c("MCS2001"))
BCS_age16_education_results = BCS_age16_education_results %>%  mutate(cohort = c("BCS1970"))
#combine cohorts 
adolescent_education_plotData = rbind(BCS_age16_education_results, MCS_age14_education_results)

#pull out coefficient, 95% CIs and cohort for plot
adolescent_education_plotData = adolescent_education_plotData %>% 
  select(term, estimate,  `2.5 %`, `97.5 %` , cohort)
names(adolescent_education_plotData) <- c("parent_education", "vocabulary", "lower_ci", "upper_ci", "cohort")


#occupational status plot data

#early childhood occupation data

#add cohort
MCS_age5_occupation_results = MCS_age5_occupation_results %>%  mutate(cohort = c("MCS2001"))
BCS_age5_occupation_results = BCS_age5_occupation_results %>%  mutate(cohort = c("BCS1970"))
#combine cohorts 
early_childhood_occupation_plotData = rbind(BCS_age5_occupation_results, MCS_age5_occupation_results)
#pull out coefficient, 95% CIs and cohort for plot
early_childhood_occupation_plotData = early_childhood_occupation_plotData %>% 
  select(term, estimate,  `2.5 %`, `97.5 %` , cohort)
#recode unemployed to ref category ie 0
early_childhood_occupation_plotData$estimate[which(
  early_childhood_occupation_plotData$term== "occupational_status1")] <-0
early_childhood_occupation_plotData$`2.5 %`[which(
  early_childhood_occupation_plotData$term== "occupational_status1")] <-0
early_childhood_occupation_plotData$`97.5 %`[which(
  early_childhood_occupation_plotData$term== "occupational_status1")] <-0

names(early_childhood_occupation_plotData) <- c("parent_occupation", "vocabulary", "lower_ci", "upper_ci", "cohort")

#late childhood occupation data

#add cohort
MCS_age11_occupation_results = MCS_age11_occupation_results %>%  mutate(cohort = c("MCS2001"))
BCS_age10_occupation_results = BCS_age10_occupation_results %>%  mutate(cohort = c("BCS1970"))
#combine cohorts 
late_childhood_occupation_plotData = rbind(BCS_age10_occupation_results, MCS_age11_occupation_results)
#pull out coefficient, 95% CIs and cohort for plot
late_childhood_occupation_plotData  = late_childhood_occupation_plotData  %>% 
  select(term, estimate,  `2.5 %`, `97.5 %` , cohort)
#convert unemployed to 0 for ref category 
late_childhood_occupation_plotData$estimate[which(
  late_childhood_occupation_plotData$term== "occupational_status1")] <-0
late_childhood_occupation_plotData$`2.5 %`[which(
  late_childhood_occupation_plotData$term== "occupational_status1")] <-0
late_childhood_occupation_plotData$`97.5 %`[which(
  late_childhood_occupation_plotData$term== "occupational_status1")] <-0
names(late_childhood_occupation_plotData) <- c("parent_occupation", "vocabulary", "lower_ci", "upper_ci", "cohort")
#adolescent occupation data

#add cohort
MCS_age14_occupation_results = MCS_age14_occupation_results %>%  mutate(cohort = c("MCS2001"))
BCS_age16_occupation_results = BCS_age16_occupation_results %>%  mutate(cohort = c("BCS1970"))
#combine cohorts 
adolescent_occupation_plotData = rbind(BCS_age16_occupation_results, MCS_age14_occupation_results)

#pull out coefficient, 95% CIs and cohort for plot
adolescent_occupation_plotData = adolescent_occupation_plotData %>% 
  select(term, estimate,  `2.5 %`, `97.5 %` , cohort)
#convert unemployed to 0 for ref category 
adolescent_occupation_plotData$estimate[which(
  adolescent_occupation_plotData$term== "occupational_status1")] <-0
adolescent_occupation_plotData$`2.5 %`[which(
  adolescent_occupation_plotData$term== "occupational_status1")] <-0
adolescent_occupation_plotData$`97.5 %`[which(
  adolescent_occupation_plotData$term== "occupational_status1")] <-0
names(adolescent_occupation_plotData) <- c("parent_occupation", "vocabulary", "lower_ci", "upper_ci", "cohort")
```

create plot of coefficients for language at each age in both cohorts

```{r}
#early childhood education

education_early_plot <- ggplot(data=early_childhood_education_plotData, aes(x=parent_education, y=vocabulary, group=cohort)) +
  geom_line(aes(color=cohort)) +
  geom_ribbon(data=early_childhood_education_plotData,aes(ymin=lower_ci, ymax=upper_ci, fill=cohort),  alpha=0.1 ) + 
  geom_point(aes(color=cohort)) +
  scale_color_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001")) +
  scale_fill_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001"))+ 
  scale_x_discrete(labels=c("highest_household_education1" = "No Qualifications \n (Reference)", 
                            "highest_household_education2" = "O-levels / \n GCSEs", "highest_household_education3" = "Post-16 \n Qualifications", 
                            "highest_household_education4" = "University-level \n Qualifications")) +
  labs( x = "Highest Household Parent Qualification", y = "Vocabulary Score \n (standardised)", size = 7) + ylim(0, 1) +
  theme_classic()+
  theme(axis.text = element_text(size=14, family = "Times", colour = "black"), axis.title = element_text(size=16, family = "Times"))+
  theme(legend.text = element_text(size=17, family="Times"), legend.title = element_text(size=18, family="Times"))

#late childhood education

education_late_plot <- ggplot(data=late_childhood_education_plotData, aes(x=parent_education, y=vocabulary, group=cohort)) +
  geom_line(aes(color=cohort)) +
  geom_ribbon(data=late_childhood_education_plotData,aes(ymin=lower_ci, ymax=upper_ci, fill=cohort),  alpha=0.1 ) + 
  geom_point(aes(color=cohort)) +
  scale_color_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001")) +
  scale_fill_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001"))+
  scale_x_discrete(labels=c("highest_household_education1" = "No Qualifications \n (Reference)", 
                            "highest_household_education2" = "O-levels / \n GCSEs", "highest_household_education3" = "Post-16 \n Qualifications", 
                            "highest_household_education4" = "University-level \n Qualifications")) +
  labs( x = "Highest Household Parent Qualification", y = "Vocabulary Score \n (standardised)", size = 7) + ylim(0, 1) +
  theme_classic()+
  theme(axis.text = element_text(size=14, family = "Times", colour = "black"), axis.title = element_text(size=16, family = "Times"))+
  theme(legend.text = element_text(size=17, family="Times"), legend.title = element_text(size=18, family="Times"))

#adolescent education 

education_adolescent_plot <- ggplot(data=adolescent_education_plotData, aes(x=parent_education, y=vocabulary, group=cohort)) +
  geom_line(aes(color=cohort)) +
  geom_ribbon(data=adolescent_education_plotData,aes(ymin=lower_ci, ymax=upper_ci, fill=cohort),  alpha=0.1 ) + 
  geom_point(aes(color=cohort)) +
  scale_color_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001")) +
  scale_fill_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001"))+
  scale_x_discrete(labels=c("highest_household_education1" = "No Qualifications \n (Reference)", 
                            "highest_household_education2" = "O-levels / \n GCSEs", "highest_household_education3" = "Post-16 \n Qualifications", 
                            "highest_household_education4" = "University-level \n Qualifications")) +
  labs( x = "Highest Household Parent Qualification", y = "Vocabulary Score \n (standardised)", size = 7) + ylim(0, 1) +
  theme_classic()+
  theme(axis.text = element_text(size=14, family = "Times", colour = "black"), axis.title = element_text(size=16, family = "Times"))+
  theme(legend.text = element_text(size=17, family="Times"), legend.title = element_text(size=18, family="Times"))

#combine

education_plots <- ggarrange(education_early_plot, education_late_plot, education_adolescent_plot,
                             labels = c("Early Childhood", "Late Childhood", "Adolescence"), 
                             #label.x=0, label.y=0,
                             font.label = list(size = 13, color = "black", face="italic", family="Times"),
                             hjust= -1,
                             vjust=1.8,
          ncol =1, nrow=3,  align = c( "hv"),
          common.legend = TRUE, legend = "right") 

#occupation plots 

occupation_early_plot <- ggplot(data=early_childhood_occupation_plotData, aes(x=parent_occupation, y=vocabulary, group=cohort)) +
  geom_line(aes(color=cohort)) +
  geom_ribbon(data=early_childhood_occupation_plotData,aes(ymin=lower_ci, ymax=upper_ci, fill=cohort),  alpha=0.1 ) + 
  geom_point(aes(color=cohort)) +
  scale_color_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001")) +
  scale_fill_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001"))+
  scale_x_discrete(labels=c("occupational_status1" = "Routine \n (Reference)", 
                            "occupational_status3" = "Intermediate", "occupational_status4" = "Professional")) +
  labs( x = "Highest Household Occupational Status", y = "Vocabulary Score \n (standardised)", size = 7) + ylim(0, 1) +
  theme_classic()+
  theme(axis.text = element_text(size=14, family = "Times", colour = "black"), axis.title = element_text(size=16, family = "Times"))+
  theme(legend.text = element_text(size=17, family="Times"), legend.title = element_text(size=18, family="Times"))

#late childhood occupation

occupation_late_plot <- ggplot(data=late_childhood_occupation_plotData, aes(x=parent_occupation, y=vocabulary, group=cohort)) +
  geom_line(aes(color=cohort)) +
  geom_ribbon(data=late_childhood_occupation_plotData,aes(ymin=lower_ci, ymax=upper_ci, fill=cohort),  alpha=0.1 ) + 
  geom_point(aes(color=cohort)) +
  scale_color_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001")) +
  scale_fill_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001"))+
  scale_x_discrete(labels=c("occupational_status1" = "Routine \n (Reference)", 
                            "occupational_status3" = "Intermediate", "occupational_status4" = "Professional")) +
  labs( x = "Highest Household Occupational Status", y = "Vocabulary Score \n (standardised)", size = 7) + ylim(0, 1) +
  theme_classic()+
  theme(axis.text = element_text(size=14, family = "Times", colour = "black"), axis.title = element_text(size=16, family = "Times"))+
  theme(legend.text = element_text(size=17, family="Times"), legend.title = element_text(size=18, family="Times"))

#adolescent occupation 

occupation_adolescent_plot <- ggplot(data=adolescent_occupation_plotData, aes(x=parent_occupation, y=vocabulary, group=cohort)) +
  geom_line(aes(color=cohort)) +
  geom_ribbon(data=adolescent_occupation_plotData,aes(ymin=lower_ci, ymax=upper_ci, fill=cohort),  alpha=0.1 ) + 
  geom_point(aes(color=cohort)) +
  scale_color_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001")) +
  scale_fill_manual(name="Cohort", values=c( "#B2ABD2", "#FDB863"), limits=c( "BCS1970", "MCS2001"))+
  scale_x_discrete(labels=c("occupational_status1" = "Routine \n (Reference)", 
                            "occupational_status3" = "Intermediate", "occupational_status4" = "Professional")) +
  labs( x = "Highest Household Occupational Status", y = "Vocabulary Score \n (standardised)", size = 7) + ylim(0, 1) +
  theme_classic()+
  theme(axis.text = element_text(size=14, family = "Times", colour = "black"), axis.title = element_text(size=16, family = "Times"))+
  theme(legend.text = element_text(size=17, family="Times"), legend.title = element_text(size=18, family="Times"))

#combine

occupation_plots <- ggarrange(occupation_early_plot, occupation_late_plot, occupation_adolescent_plot,
                             labels = c("Early Childhood", "Late Childhood", "Adolescence"), 
                             #label.x=0, label.y=0,
                             font.label = list(size = 13, color = "black", face="italic", family="Times"),
                             hjust= -1,
                             vjust=1.8,
                             ncol =1, nrow=3,  align = c( "hv"),
                             common.legend = TRUE, legend = "right") 

#combine education and occupation into one plot 

early_childhood = ggarrange(education_early_plot, occupation_early_plot, 
                             #labels = c("Early Childhood"), 
                             #hjust = -3, 
                             #font.label = list(size = 7, color = "black", face="bold" ),
                             ncol =2, nrow=1,  align = c( "hv"),
                             common.legend = TRUE, legend = "none") 
#earlyChildhood = early_childhood + rremove("legend")

early_childhood1 = annotate_figure(early_childhood,
                top = text_grob("Early Childhood", color="black", face="bold", size=18, family="Times"))



late_childhood = ggarrange(education_late_plot, occupation_late_plot, 
                            #labels = c("Early Childhood"), 
                            #hjust = -3, 
                            #font.label = list(size = 7, color = "black", face="bold" ),
                            ncol =2, nrow=1,  align = c( "hv"),
                            common.legend = TRUE, legend = "none")
late_childhood1= annotate_figure(late_childhood,
                top = text_grob("Late Childhood", color="black", face="bold", size=18, family="Times"))

adolescence= ggarrange(education_adolescent_plot, occupation_adolescent_plot, 
                           #labels = c("Early Childhood"), 
                           #hjust = -3, 
                           #font.label = list(size = 7, color = "black", face="bold" ),
                           ncol =2, nrow=1,  align = c( "hv"),
                           common.legend = TRUE, legend = "none")
adolescence1= annotate_figure(adolescence,
                top = text_grob("Adolescence", color="black", face="bold", size=18, family="Times"))

combined_plot= ggarrange(early_childhood1, late_childhood1, adolescence1, 
          #labels = c("Early Childhood", "", "Late Childhood","", "Adolescence", ""), 
          #hjust = -7, 
          #font.label = list(size = 7, color = "black", face="bold" ),
          ncol =1, nrow=3,  align = c( "hv"),
          legend.grob = get_legend(education_early_plot), legend="right")

ggsave("cross-cohort.png", combined_plot, width=14.8, height=16.3, units= "in" ,dpi=300)
#add title and footnote information to bottom of plot. this will be Fig. 3. 
#p =combined_plot + labs(title = "Fig. 3: Cross-cohort relatonships between SEC and language ability") +
  # theme(plot.title = element_text(face="bold", size=15, family ="Times", vjust = 10))

#p1 = p + labs(caption = "Vocabulary in early childhood (top), late childhood (middle) and adolescence (bottom), \n plotted as a function of highest household parent education (left) and highest houshold occupational status (right) in two cohorts") + 
  # theme(plot.caption = element_text( size=12, family ="Times"))

```



r2 plot
```{r}
#early language
#early language education partial 
#add cohort and indicator 
bcsearly_educationPartial =as.data.frame(bcs_age5_education_partial[,1])
bcsearly_educationPartial = bcsearly_educationPartial %>%  add_column(cohort= c("BCS1970 \n Highest Household \n Education"), .before =1 )
bcsearly_educationPartial = bcsearly_educationPartial %>%  add_column(indicator= c("BCS1970 \n Highest Household \n Education"), .before =2 )
names(bcsearly_educationPartial) = c("cohort", "indicator", "r2")

mcsearly_educationPartial =as.data.frame(mcs_age5_education_partial[,1])
mcsearly_educationPartial = mcsearly_educationPartial %>%  add_column(indicator= c("MCS2001 \n Highest Household \n Education"), .before =1 )
mcsearly_educationPartial = mcsearly_educationPartial %>%  add_column(cohort= c("MCS2001 \n Highest Household \n Education"), .before =2 )
names(mcsearly_educationPartial) = c("cohort", "indicator", "r2")

#early childhood and occupation
bcsearly_occupationPartial =as.data.frame(bcs_age5_occupation_partial[,1])
bcsearly_occupationPartial = bcsearly_occupationPartial %>%  add_column(indicator= c("BCS1970 \n Highest Household \n Occupation"), .before =1 )
bcsearly_occupationPartial = bcsearly_occupationPartial %>%  add_column(cohort= c("BCS1970 \n Highest Household \n Occupation"), .before =2 )
names(bcsearly_occupationPartial) = c("cohort", "indicator", "r2")

mcsearly_occupationPartial =as.data.frame(mcs_age5_occupation_partial[,1])
mcsearly_occupationPartial = mcsearly_occupationPartial %>%  add_column(indicator= c("MCS2001 \n Highest Household \n Occupation"), .before =1 )
mcsearly_occupationPartial = mcsearly_occupationPartial %>%  add_column(cohort= c("MCS2001 \n Highest Household \n Occupation"), .before =2 )
names(mcsearly_occupationPartial) = c("cohort", "indicator", "r2")

earlyLang_Partial = rbind(bcsearly_educationPartial, bcsearly_occupationPartial, 
                          mcsearly_educationPartial, mcsearly_occupationPartial)
earlyLang_Partial = earlyLang_Partial %>%  mutate(vocab = c("Early Childhood"), .before = 1)

#late language
#late language education partial 
#add cohort and indicator 
bcslate_educationPartial =as.data.frame(bcs_age10_education_partial[,1])
bcslate_educationPartial = bcslate_educationPartial %>%  add_column(indicator= c("BCS1970 \n Highest Household \n Education"), .before =1 )
bcslate_educationPartial = bcslate_educationPartial %>%  add_column(cohort= c("BCS1970 \n Highest Household \n Education"), .before =2 )
names(bcslate_educationPartial) = c("cohort", "indicator", "r2")

mcslate_educationPartial =as.data.frame(mcs_age11_education_partial[,1])
mcslate_educationPartial = mcslate_educationPartial %>%  add_column(indicator= c("MCS2001 \n Highest Household \n Education"), .before =1 )
mcslate_educationPartial = mcslate_educationPartial %>%  add_column(cohort= c("MCS2001 \n Highest Household \n Education"), .before =2 )
names(mcslate_educationPartial) = c("cohort", "indicator", "r2")

#late childhood and occupation
bcslate_occupationPartial =as.data.frame(bcs_age10_occupation_partial[,1])
bcslate_occupationPartial = bcslate_occupationPartial %>%  add_column(indicator= c("BCS1970 \n Highest Household \n Occupation"), .before =1 )
bcslate_occupationPartial = bcslate_occupationPartial %>%  add_column(cohort= c("BCS1970 \n Highest Household \n Occupation"), .before =2 )
names(bcslate_occupationPartial) = c("cohort", "indicator", "r2")

mcslate_occupationPartial =as.data.frame(mcs_age11_occupation_partial[,1])
mcslate_occupationPartial = mcslate_occupationPartial %>%  add_column(indicator= c("MCS2001 \n Highest Household \n Occupation"), .before =1 )
mcslate_occupationPartial = mcslate_occupationPartial %>%  add_column(cohort= c("MCS2001 \n Highest Household \n Occupation"), .before =2 )
names(mcslate_occupationPartial) = c("cohort", "indicator", "r2")

lateLang_Partial = rbind(bcslate_educationPartial,bcslate_occupationPartial,
                         mcslate_educationPartial, mcslate_occupationPartial)
lateLang_Partial = lateLang_Partial %>%  mutate(vocab = c("Late Childhood"), .before = 1)


#adolescent language
#adolescent language education partial 
#add cohort and indicator 
bcsadolescent_educationPartial =as.data.frame(bcs_age16_education_partial[,1])
bcsadolescent_educationPartial = bcsadolescent_educationPartial %>%  add_column(indicator= c("BCS1970 \n Highest Household \n Education"), .before =1 )
bcsadolescent_educationPartial = bcsadolescent_educationPartial %>%  add_column(cohort= c("BCS1970 \n Highest Household \n Education"), .before =2 )
names(bcsadolescent_educationPartial) = c("cohort", "indicator", "r2")

mcsadolescent_educationPartial =as.data.frame(mcs_age14_education_partial[,1])
mcsadolescent_educationPartial = mcsadolescent_educationPartial %>%  add_column(indicator= c("MCS2001 \n Highest Household \n Education"), .before =1 )
mcsadolescent_educationPartial = mcsadolescent_educationPartial %>%  add_column(cohort= c("MCS2001 \n Highest Household \n Education"), .before =2 )
names(mcsadolescent_educationPartial) = c("cohort", "indicator", "r2")

#adolescent childhood and occupation
bcsadolescent_occupationPartial =as.data.frame(bcs_age16_occupation_partial[,1])
bcsadolescent_occupationPartial = bcsadolescent_occupationPartial %>%  add_column(indicator= c("BCS1970 \n Highest Household \n Occupation"), .before =1 )
bcsadolescent_occupationPartial = bcsadolescent_occupationPartial %>%  add_column(cohort= c("BCS1970 \n Highest Household \n Occupation"), .before =2 )
names(bcsadolescent_occupationPartial) = c("cohort", "indicator", "r2")

mcsadolescent_occupationPartial =as.data.frame(mcs_age14_occupation_partial[,1])
mcsadolescent_occupationPartial = mcsadolescent_occupationPartial %>%  add_column(indicator= c("MCS2001 \n Highest Household \n Occupation"), .before =1 )
mcsadolescent_occupationPartial = mcsadolescent_occupationPartial %>%  add_column(cohort= c("MCS2001 \n Highest Household \n Occupation"), .before =2 )
names(mcsadolescent_occupationPartial) = c("cohort", "indicator", "r2")

adolescentLang_Partial = rbind(bcsadolescent_educationPartial,bcsadolescent_occupationPartial,
                               mcsadolescent_educationPartial, mcsadolescent_occupationPartial)
adolescentLang_Partial = adolescentLang_Partial %>%  mutate(vocab = c("Adolescence"), .before = 1)


#put all together into one dataframe for plot
partialr2_data = rbind(earlyLang_Partial, lateLang_Partial, adolescentLang_Partial)
partialr2_data$indicator = as.factor(partialr2_data$indicator)
partialr2_data$cohort = as.factor(partialr2_data$cohort)
partialr2_data$vocab = as.factor(partialr2_data$vocab)



#plot

r2_plot1 <- partialr2_data %>% 
  mutate(vocab = fct_relevel(vocab, 
                            "Early Childhood", "Late Childhood", "Adolescence")) %>% #reorder age for x axis 
  ggplot() +
  geom_point(mapping=aes(x=vocab, y=r2,  group= cohort, color=cohort, fill=cohort, shape = indicator), 
             size=5, position = position_dodge(width=0.5)) +
  scale_color_manual(name="Cohort and Indicator", values=c( "#B2ABD2","#B2ABD2", "#FDB863", "#FDB863"), 
                     limits=c( "BCS1970 \n Highest Household \n Education", "BCS1970 \n Highest Household \n Occupation",
                               "MCS2001 \n Highest Household \n Education", "MCS2001 \n Highest Household \n Occupation")) +
  scale_fill_manual(name="Cohort and Indicator", values=c( "#B2ABD2","#B2ABD2", "#FDB863", "#FDB863"), 
                    limits=c("BCS1970 \n Highest Household \n Education", "BCS1970 \n Highest Household \n Occupation",
                             "MCS2001 \n Highest Household \n Education", "MCS2001 \n Highest Household \n Occupation")) +
scale_shape_manual(name= "Cohort and Indicator", values =c(15, 16, 15,  16), 
                    limits = c ("BCS1970 \n Highest Household \n Education", "BCS1970 \n Highest Household \n Occupation",
                                "MCS2001 \n Highest Household \n Education", "MCS2001 \n Highest Household \n Occupation")) +
  theme_classic2()+
  xlab(label="\n Vocabulary") +
  ylab(label="Partial R squared (%)") +
  theme(axis.text = element_text(size=15, family = "Times", colour = "black"), 
        axis.title = element_text(size=15, family = "Times"))+
  theme(legend.text = element_text(size=15, family="Times"), 
        legend.title = element_text(size=15, family="Times"))+
  ylim(0,12)+ 
  geom_vline(xintercept = 1.5:3.5, colour="#E0E0E0") +
  theme(legend.position = "top") +
  
 #ggtitle("Main Analysis") +
 #theme(plot.title = element_text(face="italic", size=15, family ="Times",hjust = 0.5)) +
  
  geom_text(aes(x=vocab, y=r2, label=round(r2,1), color=factor(cohort), hjust=-1.4),
            family = "Times New Roman",
            position = position_dodge(width=0.5)) 
  #main = annotate_figure(r2_plot1, top = text_grob("Main Analysis", 
       #                           color="black", face="bold", 
                  #                size=14, family="Times"))

r2_plot1

ggsave("cross-cohort-r2.png",r2_plot1, width=11, height=11.5, units= "in" ,dpi=300)


```

